<!DOCTYPE html>
<html lang="ru_RU">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Cypher query language | My knowledge base</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Cypher query language" />
<meta property="og:locale" content="ru_RU" />
<meta name="description" content="Декларативный язык запросов cypher" />
<meta property="og:description" content="Декларативный язык запросов cypher" />
<link rel="canonical" href="https://konstantinklepikov.github.io/myknowlegebase/notes/cypher.html" />
<meta property="og:url" content="https://konstantinklepikov.github.io/myknowlegebase/notes/cypher.html" />
<meta property="og:site_name" content="My knowledge base" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://konstantinklepikov.github.io/myknowlegebase/notes/cypher.html","headline":"Cypher query language","description":"Декларативный язык запросов cypher","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="keywords" content="">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    
    
    <link rel="stylesheet" href="https://konstantinklepikov.github.io/myknowlegebase/assets/style.css">
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->


      <!-- Yandex.Metrika counter -->
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(53548570, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
    });
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/53548570" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
      <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-139620627-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-139620627-1');
  </script>


<!-- Favicon -->
<link rel="icon" href="https://konstantinklepikov.github.io/myknowlegebase/assets/img/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="https://konstantinklepikov.github.io/myknowlegebase/assets/img/favicon.ico" type="image/x-icon">

<!-- Math support -->
<!-- Mathjax Support -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- tags collection-->

    







<!-- end custom head snippets -->

</head>

  <body>

    <header class="border-bottom-thick px-2 clearfix">
    <div class="left sm-width-full py-1 mt-1 mt-lg-0">
      <a class="align-middle link-primary text-accent" href="https://konstantinklepikov.github.io/">
        My deep learning
      </a>
    </div>
    <div class="right sm-width-full">
      <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/myknowlegebase/">
            My knowledge base
          </a>
        </li>
      </ul>
    </div>
  </header>

    <main role="main">

      
<article class="container mx-auto px-2 mt2 mb4">
  <header>
    <h1 class="h1 col-9 sm-width-full py-4 mt-3 inline-block" itemprop="name headline">Cypher query language</h1>
  </header>
  <div class="col-4 sm-width-full border-top-thin">
    <p class="mb-3 h5">Теги:
      
        
        <a href="/myknowlegebase/tag/bd" title="bd" class="link-tags">bd&nbsp;</a>
      
        
        <a href="/myknowlegebase/tag/graphs" title="graphs" class="link-tags">graphs&nbsp;</a>
      
      </p>
  </div>
  <div class="prose mb-4 py-4">
    <p>Cypher — это язык графовых запросов [<a href="neo4j" title="Neo4j graph data base">neo4j</a>], который позволяет извлекать данные из графа. Это похоже на SQL для графов, и он был вдохновлен SQL, поэтому он позволяет вам сосредоточиться на том, какие данные вы хотите получить из графа (а не на том, как их получить). Это самый простой язык графов для изучения из-за его сходства с другими языками и интуитивности.</p>

<p><img src="/myknowlegebase/attachments/2022-08-01-16-08-43.png" alt="cypher example" /></p>

<p>Поскольку Cypher предназначен для чтения человеком, его конструкция основан на английской лексике, чтобы сделать синтаксис наглядным и понятным.</p>

<p><img src="/myknowlegebase/attachments/2022-08-03-14-14-38.png" alt="cypher example" /></p>

<p>Узлы в cypher могут быть анонимными (результат будет отброшен в конце вычисленийц) или поименованными меткой. Результат можно присваивать переменной.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span>                  <span class="o">//</span><span class="n">anonymous</span> <span class="n">node</span> <span class="p">(</span><span class="k">no</span> <span class="n">label</span> <span class="k">or</span> <span class="k">variable</span><span class="p">)</span>
                    <span class="o">//</span><span class="n">can</span> <span class="n">refer</span> <span class="k">to</span> <span class="k">any</span> <span class="n">node</span> <span class="k">in</span> <span class="n">the</span> <span class="k">database</span>
<span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span>          <span class="o">//</span><span class="k">using</span> <span class="k">variable</span> <span class="n">p</span> <span class="k">and</span> <span class="n">label</span> <span class="n">Person</span>
<span class="p">(:</span><span class="n">Technology</span><span class="p">)</span>       <span class="o">//</span><span class="k">no</span> <span class="k">variable</span><span class="p">,</span> <span class="n">label</span> <span class="n">Technology</span>
<span class="p">(</span><span class="k">work</span><span class="p">:</span><span class="n">Company</span><span class="p">)</span>      <span class="o">//</span><span class="k">using</span> <span class="k">variable</span> <span class="k">work</span> <span class="k">and</span> <span class="n">label</span> <span class="n">Company</span>
</code></pre></div></div>

<p>Отношения представлены в Cypher с помощью стрелки –&gt; или &lt;– между двумя узлами. Ненаправленные отношения представлены без стрелки и только с двумя тире –. Это означает, что связь может быть пройдена в любом направлении. Хотя направление должно быть указано для связи в бд, его можно сопоставить с ненаправленным отношением, когда Cypher игнорирует любое конкретное направление и извлекает отношение и подключенные узлы, независимо от физического направления. Это позволяет запросам быть гибкими и не заставлять пользователя знать физическое направление отношений, хранящихся в базе данных.</p>

<p>Если данные хранятся с одним направлением связи, а в запросе указано неправильное направление, Cypher не вернет никаких результатов. В тех случаях, когда вы не уверены в направлении, лучше использовать ненаправленную связь и получить некоторые результаты.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">//</span><span class="k">data</span> <span class="n">stored</span> <span class="k">with</span> <span class="n">this</span> <span class="n">direction</span>
<span class="k">CREATE</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">LIKES</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">:</span><span class="n">Technology</span><span class="p">)</span>

<span class="o">//</span><span class="n">query</span> <span class="n">relationship</span> <span class="n">backwards</span> <span class="n">will</span> <span class="k">not</span> <span class="k">return</span> <span class="n">results</span>
<span class="k">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">LIKES</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="p">:</span><span class="n">Technology</span><span class="p">)</span>

<span class="o">//</span><span class="n">better</span> <span class="k">to</span> <span class="n">query</span> <span class="k">with</span> <span class="n">undirected</span> <span class="n">relationship</span> <span class="n">unless</span> <span class="n">sure</span> <span class="k">of</span> <span class="n">direction</span>
<span class="k">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">LIKES</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="p">:</span><span class="n">Technology</span><span class="p">)</span>
</code></pre></div></div>

<p>Типы отношений классифицируют отношения и придают им значение, аналогично тому, как метки группируют узлы. Обычно вы можете идентифицировать отношения в своей модели данных, найдя действия или глаголы. Вы можете указать любой тип отношений между узлами, который вы хотите, но мы рекомендуем использовать хорошие соглашения об именах, используя глаголы и действия. Плохие имена типов отношений затрудняют чтение и запись Cypher (помните, это должно звучать как английский!).</p>

<p><img src="/myknowlegebase/attachments/2022-08-03-14-20-26.png" alt="cypher relations" /></p>

<p>Как и в случае с узлами, если мы хотим позже обратиться к связи в запросе, мы можем указать для нее переменную типа <code class="language-plaintext highlighter-rouge">[r]</code>или <code class="language-plaintext highlighter-rouge">[rel]</code>. Мы также можем использовать более длинные и выразительные имена переменных, такие как <code class="language-plaintext highlighter-rouge">[likes]</code> или <code class="language-plaintext highlighter-rouge">[knows]</code>. Если вам не нужно ссылаться на связь позже, вы можете указать анонимную связь с помощью двух дефисов <code class="language-plaintext highlighter-rouge">--</code>, <code class="language-plaintext highlighter-rouge">--&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;--</code>.</p>

<p>Например, вы можете использовать или <code class="language-plaintext highlighter-rouge">-[rel]-&gt;</code> или <code class="language-plaintext highlighter-rouge">-[rel:LIKES]-&gt;</code> и вызвать <code class="language-plaintext highlighter-rouge">rel</code> переменную позже в своем запросе, чтобы сослаться на связь и ее детали.</p>

<p>Если вы забудете поставить двоеточие перед таким типом отношения <code class="language-plaintext highlighter-rouge">-[LIKES]-&gt;</code>, оно представляет собой переменную (а не тип отношения). Поскольку тип отношений не объявлен, Cypher будет искать все типы отношений.</p>

<p>Свойства в cypher представляют собой пары «имя-значение», которые предоставляют дополнительную информацию для наших узлов и отношений. Чтобы представить их в Cypher, мы можем использовать фигурные скобки внутри круглых скобок узла или скобок отношения. Затем имя и значение свойства заключаются в фигурные скобки: <code class="language-plaintext highlighter-rouge">-[rel:IS_FRIENDS_WITH {since: 2018}]-&gt;</code></p>

<p><img src="/myknowlegebase/attachments/2022-08-03-14-26-22.png" alt="cypher properties" /></p>

<p><a href="https://neo4j.com/docs/cypher-manual/current/syntax/values/">Доступные типы данных свойств</a></p>

<p>Основой всех запросов в cypher являются паттерны. Пример:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="nv">"Jennifer"</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">rel</span><span class="p">:</span><span class="n">LIKES</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="k">g</span><span class="p">:</span><span class="n">Technology</span> <span class="err">{</span><span class="k">type</span><span class="p">:</span> <span class="nv">"Graphs"</span><span class="err">}</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="cypher-keywords"><a href="https://neo4j.com/developer/cypher/querying/">cypher keywords</a></h2>

<p>Как и в большинстве языков программирования, в Cypher есть несколько слов, зарезервированных для определенных действий в частях запроса. Нам нужна возможность создавать, читать, обновлять или удалять данные в Neo4j, и ключевые слова помогают нам выполнять эту функцию.</p>

<p><strong>MATCH</strong>. Ключевое слово MATCH в Cypher — это то, что ищет существующий узел, отношение, метку, свойство или шаблон в базе данных. Если вы знакомы с SQL, MATCH работает почти так же, как SELECT в SQL.</p>

<p>Вы можете найти все метки узлов в базе данных, выполнить поиск определенного узла, найти все узлы с определенной взаимосвязью, найти закономерности узлов и взаимосвязей и многое другое с помощью MATCH.</p>

<p><strong>RETURN</strong>. Ключевое слово RETURN в Cypher указывает, какие значения или результаты вы хотите вернуть из запроса Cypher. Вы можете указать Cypher возвращать узлы, отношения, свойства узлов и отношений или шаблоны в результатах вашего запроса. RETURN не требуется при выполнении процедур записи, но необходим для чтения.</p>

<p>Переменные узла и отношения, которые мы обсуждали ранее, становятся важными при использовании RETURN. Чтобы вернуть узлы, отношения, свойства или шаблоны, вам необходимо указать переменные в вашем MATCH предложении для данных, которые вы хотите вернуть.</p>

<p>Все узлы с меткой Person</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span>
<span class="k">RETURN</span> <span class="n">p</span>
<span class="k">LIMIT</span> <span class="mi">1</span>
</code></pre></div></div>

<p>С определенным значением свойства на узле (имя режисера)</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(</span><span class="n">tom</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Tom Hanks'</span><span class="err">}</span><span class="p">)</span>
<span class="k">RETURN</span> <span class="n">tom</span>
</code></pre></div></div>

<p>Фильмы данного режиссера</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Tom Hanks'</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">DIRECTED</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span>
<span class="k">RETURN</span> <span class="n">movie</span>
</code></pre></div></div>

<p>Как и в случае с SQL, вы можете переименовать возвращаемые результаты, используя AS и псевдоним свойства с более понятным именем.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">//</span><span class="n">cleaner</span> <span class="n">printed</span> <span class="n">results</span> <span class="k">with</span> <span class="n">aliasing</span>
<span class="k">MATCH</span> <span class="p">(</span><span class="n">tom</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="s1">'Tom Hanks'</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">rel</span><span class="p">:</span><span class="n">DIRECTED</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span>
<span class="k">RETURN</span> <span class="n">tom</span><span class="p">.</span><span class="n">name</span>
<span class="k">AS</span> <span class="n">name</span><span class="p">,</span> <span class="n">tom</span><span class="p">.</span><span class="n">born</span>
<span class="k">AS</span> <span class="nv">`Year Born`</span><span class="p">,</span> <span class="n">movie</span><span class="p">.</span><span class="n">title</span>
<span class="k">AS</span> <span class="n">title</span><span class="p">,</span> <span class="n">movie</span><span class="p">.</span><span class="n">released</span>
<span class="k">AS</span> <span class="nv">`Year Released`</span>
</code></pre></div></div>

<h3 id="create-update-and-delete-operations"><a href="https://neo4j.com/developer/cypher/updating/">Create, Update, and Delete Operations</a></h3>

<p>CRUD в графе работаtт немного иначе, чем в других типах баз данных.</p>

<p>Добавление данных в Cypher работает очень похоже на оператор вставки любого другого языка доступа к данным. Однако вместо INSERT, как в SQL, Cypher использует CREATE. Вы можете использовать CREATE для вставки узлов, отношений и шаблонов в Neo4j.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="p">(</span><span class="n">friend</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Mark'</span><span class="err">}</span><span class="p">)</span>
<span class="k">RETURN</span> <span class="n">friend</span>

<span class="k">MATCH</span> <span class="p">(</span><span class="n">jennifer</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="err">}</span><span class="p">)</span>
<span class="k">MATCH</span> <span class="p">(</span><span class="n">mark</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Mark'</span><span class="err">}</span><span class="p">)</span>
<span class="k">CREATE</span> <span class="p">(</span><span class="n">jennifer</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">rel</span><span class="p">:</span><span class="n">IS_FRIENDS_WITH</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">mark</span><span class="p">)</span>
</code></pre></div></div>

<p>Обратите внимание, что мы запускаем два MATCH запроса, прежде чем создать связь между узлами. Почему это? Причина, по которой мы сначала выполняем сопоставление для узла Дженнифер и сопоставления для узла Марка, заключается в том, что CREATE ключевое слово выполняет слепую вставку и создает весь шаблон, независимо от того, существует ли он уже в базе данных. Это означает, что при выполнении приведенного ниже оператора Cypher будут вставлены дубликаты узлов Jennifer и Mark. Чтобы этого избежать, наш предыдущий запрос сначала нашел существующие узлы, а затем создал между ними новую связь.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">//</span><span class="n">this</span> <span class="n">query</span> <span class="n">will</span> <span class="k">create</span> <span class="n">duplicate</span> <span class="n">nodes</span> <span class="k">for</span> <span class="n">Mark</span> <span class="k">and</span> <span class="n">Jennifer</span>
<span class="k">CREATE</span> <span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">rel</span><span class="p">:</span><span class="n">IS_FRIENDS_WITH</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Mark'</span><span class="err">}</span><span class="p">)</span>
</code></pre></div></div>

<p>Возможно, у вас уже есть узел или связь в данных, но вы хотите изменить их свойства. Это можно сделать, сопоставив шаблон, который вы хотите найти, и используя SET для добавления, удаления или обновления свойств.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="err">}</span><span class="p">)</span>
<span class="k">SET</span> <span class="n">p</span><span class="p">.</span><span class="n">birthdate</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'1980-01-01'</span><span class="p">)</span>
<span class="k">RETURN</span> <span class="n">p</span>
</code></pre></div></div>

<p>Если бы мы теперь хотели изменить ее день рождения, мы могли бы использовать тот же запрос выше, чтобы снова найти узел Дженнифер и указать другую дату в SET.</p>

<p>Мы также можем обновить информацию об WORKS_FOR отношениях Дженнифер с ее компанией, указав год, когда она начала там работать. Для этого вы можете использовать синтаксис, аналогичный приведенному выше, для обновления узлов.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">rel</span><span class="p">:</span><span class="n">WORKS_FOR</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">Company</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Neo4j'</span><span class="err">}</span><span class="p">)</span>
<span class="k">SET</span> <span class="n">rel</span><span class="p">.</span><span class="n">startYear</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="err">{</span><span class="nb">year</span><span class="p">:</span> <span class="mi">2018</span><span class="err">}</span><span class="p">)</span>
<span class="k">RETURN</span> <span class="n">rel</span>
</code></pre></div></div>

<p>Еще одна операция, которую мы рассмотрим, — это удаление данных в Cypher. Для этой операции Cypher использует DELETE - ключевое слово для удаления узлов и связей. Это очень похоже на удаление данных в других языках, таких как SQL, за одним исключением. Поскольку Neo4j совместим с ACID, вы не можете удалить узел, если он все еще имеет связи. Если бы вы могли это сделать, вы могли бы получить связь, не указывающую на узел, и неполный граф. Мы рассмотрим, как удалить отключенный узел, связь, а также узел, у которого все еще есть связи.</p>

<p>Чтобы удалить связь, нужно найти начальный и конечный узлы для связи, которое вы хотите удалить, а затем использовать DELETE.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="err">}</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">IS_FRIENDS_WITH</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Mark'</span><span class="err">}</span><span class="p">)</span>
<span class="k">DELETE</span> <span class="n">r</span>
</code></pre></div></div>

<p>Чтобы удалить узел, который не имеет никаких связей, нужно найти узел, который вы хотите удалить, а затем использовать DELETE.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Mark'</span><span class="err">}</span><span class="p">)</span>
<span class="k">DELETE</span> <span class="n">m</span>
</code></pre></div></div>

<p>Вместо выполнения двух последних запросов для удаления IS_FRIENDS_WITH маязи и Person узла для Марка мы можем выполнить один оператор для одновременного удаления узла и связи. Как мы упоминали выше, Neo4j совместим с ACID, поэтому он не позволяет нам удалять узел, если он все еще имеет связи. Использование DETACH DELETE синтаксиса говорит Cypher удалить любые связи, которые есть у узла, а также удалить сам узел.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">MATCH</span> <span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Mark'</span><span class="err">}</span><span class="p">)</span>
<span class="n">DETACH</span> <span class="k">DELETE</span> <span class="n">m</span>
</code></pre></div></div>

<p>Вы также можете удалить свойства, но вместо использования DELETE мы можем использовать несколько других подходов. Первый вариант заключается в использовании REMOVE. Это сообщает Neo4j, что вы хотите полностью удалить свойство из узла и больше не хранить его.</p>

<p>Второй вариант — использовать SET, чтобы установить значение свойства в null. В отличие от других моделей баз данных, Neo4j не хранит нулевые значения. Вместо этого он хранит только те свойства и значения, которые имеют смысл для ваших данных. Это означает, что у вас могут быть разные типы и количество свойств на различных узлах и отношениях в вашем графе.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">//</span><span class="k">delete</span> <span class="n">property</span> <span class="k">using</span> <span class="n">REMOVE</span> <span class="n">keyword</span>
<span class="k">MATCH</span> <span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="err">}</span><span class="p">)</span>
<span class="n">REMOVE</span> <span class="n">n</span><span class="p">.</span><span class="n">birthdate</span>

<span class="o">//</span><span class="k">delete</span> <span class="n">property</span> <span class="k">with</span> <span class="k">SET</span> <span class="k">to</span> <span class="k">null</span> <span class="n">value</span>
<span class="k">MATCH</span> <span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Person</span> <span class="err">{</span><span class="n">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="err">}</span><span class="p">)</span>
<span class="k">SET</span> <span class="n">n</span><span class="p">.</span><span class="n">birthdate</span> <span class="o">=</span> <span class="k">null</span>
</code></pre></div></div>

<p>Смотир еще:</p>

<ul>
  <li><a href="https://neo4j.com/developer/cypher/">документация для neo4j</a></li>
  <li><a href="http://opencypher.org/">openCypher</a></li>
  <li>[<a href="../lists/graphs" title="Machine learning with graphs">graphs</a>]</li>
  <li>[<a href="neo4j" title="Neo4j graph data base">neo4j</a>]</li>
  <li>[<a href="python-api-neo4j" title="Python api for neo4j">python-api-neo4j</a>]</li>
</ul>


  </div>
</article>


    </main>

    <footer role="banner">
<div class="border-top-thin clearfix mt-2 mt-lg-4">
    <div class="container mx-auto px-2">
      <p class="col-8 sm-width-full left py-2 mb-0"><a href="/myknowlegebase/">My knowledge base</a> проект поддерживается <a class="text-accent" href="https://github.com/KonstantinKlepikov">KonstantinKlepikov</a></p>
      <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
        <li class="inline-block mr-1">
          <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="My knowledge base">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </li>
      </ul>
    </div>
  </div>
</footer>

  </body>

</html>

<script type="text/javascript">
  // Hack: Replace page-link with "Page Title"
  document.querySelectorAll(".markdown-body a[title]").forEach((a) => {
    a.innerText = a.title;
  });
  // Hack: Remove .md extension from wikilinks to get the html in jekyll
  document.querySelectorAll("a").forEach(l => {
    if (l.href.endsWith('.md')) {
      l.href = l.href.substring(0, l.href.length-3)
    }
  })
</script>