<!DOCTYPE html>
<html lang="ru_RU">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Python patterns programming | My knowledge base</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Python patterns programming" />
<meta property="og:locale" content="ru_RU" />
<meta name="description" content="Объектные паттерны в python" />
<meta property="og:description" content="Объектные паттерны в python" />
<link rel="canonical" href="https://konstantinklepikov.github.io/myknowlegebase/notes/python-patterns.html" />
<meta property="og:url" content="https://konstantinklepikov.github.io/myknowlegebase/notes/python-patterns.html" />
<meta property="og:site_name" content="My knowledge base" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://konstantinklepikov.github.io/myknowlegebase/notes/python-patterns.html","headline":"Python patterns programming","description":"Объектные паттерны в python","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="keywords" content="">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    
    
    <link rel="stylesheet" href="https://konstantinklepikov.github.io/myknowlegebase/assets/style.css">
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->


      <!-- Yandex.Metrika counter -->
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(53548570, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
    });
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/53548570" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
      <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-139620627-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-139620627-1');
  </script>


<!-- Favicon -->
<link rel="icon" href="https://konstantinklepikov.github.io/myknowlegebase/assets/img/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="https://konstantinklepikov.github.io/myknowlegebase/assets/img/favicon.ico" type="image/x-icon">

<!-- Math support -->
<!-- Mathjax Support -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- tags collection-->

    







<!-- end custom head snippets -->

</head>

  <body>

    <header class="border-bottom-thick px-2 clearfix">
    <div class="left sm-width-full py-1 mt-1 mt-lg-0">
      <a class="align-middle link-primary text-accent" href="/myknowlegebase/">
        My knowledge base
      </a>
    </div>
    <div class="right sm-width-full">
      <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="https://konstantinklepikov.github.io/">
            My deep learning
          </a>
        </li>
      </ul>
    </div>
  </header>

    <main role="main">

      <article class="container mx-auto px-2 mt2 mb4">
  <header>
    <h1 class="h1 col-9 sm-width-full py-4 mt-3 inline-block" itemprop="name headline">Python patterns programming</h1>
  </header>
  <div class="col-4 sm-width-full border-top-thin">
    <p class="mb-3 h5">Теги:
      
        
        <a href="/myknowlegebase/tag/python-standart-library" title="python-standart-library" class="link-tags">python-standart-library&nbsp;</a>
      
      </p>
  </div>
  <div class="prose mb-4 py-4">
    <p>Примеры кода и тесты, демонстрирующие работу паттернов, можно найти <a href="https://github.com/faif/python-patterns">в этом репозитории</a></p>

<p>В ряде примеров можно встретить конструкцию <code class="language-plaintext highlighter-rouge">from __future__ import annotations</code>. Для чего это используется смотри тут: [<a href="from-future-import-annotations" title="From future import annotations">from-future-import-annotations</a>]. Больше про аннотации читай в [<a href="type-annotation" title="Аннотация типов в python">type-annotation</a>] и [<a href="typing" title="Typing">typing</a>]</p>

<h2 id="delegation">Delegation</h2>

<p>Здесь делегейтору передается делегируемый экземпляр клесса, обрабатывающий запрос. Внутри делегатора мы получаем атрибуты делегируемого класса и реализуем новое поведение для них.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>


<span class="k">class</span> <span class="nc">Delegator</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delegate</span><span class="p">:</span> <span class="n">Delegate</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">delegate</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">delegate</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">attr</span>

        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">attr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">Delegate</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">p1</span> <span class="o">=</span> <span class="mi">123</span>

    <span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">something</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">f"Doing </span><span class="si">{</span><span class="n">something</span><span class="si">}</span><span class="s">"</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">delegator</span> <span class="o">=</span> <span class="n">Delegator</span><span class="p">(</span><span class="n">Delegate</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">delegator</span><span class="p">.</span><span class="n">p1</span>
<span class="mi">123</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">delegator</span><span class="p">.</span><span class="n">p2</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="p">...</span>
<span class="nb">AttributeError</span><span class="p">:</span> <span class="s">'Delegate'</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">'p2'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">delegator</span><span class="p">.</span><span class="n">do_something</span><span class="p">(</span><span class="s">"nothing"</span><span class="p">)</span>
<span class="s">'Doing nothing'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">delegator</span><span class="p">.</span><span class="n">do_anything</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="p">...</span>
<span class="nb">AttributeError</span><span class="p">:</span> <span class="s">'Delegate'</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">'do_anything'</span>
</code></pre></div></div>

<h2 id="порождающие-паттерны">Порождающие паттерны</h2>

<h3 id="builder">Builder</h3>

<p>Необходим для разделения спецификации объекта и его представления. В python реализован [<a href="abc" title="Abc">abc</a>]</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/creational/builder.py">Пример без abc</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Abstract Building
</span><span class="k">class</span> <span class="nc">Building</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">build_floor</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">build_size</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">build_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"Floor: {0.floor} | Size: {0.size}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="c1"># Concrete Buildings
</span><span class="k">class</span> <span class="nc">House</span><span class="p">(</span><span class="n">Building</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">build_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">floor</span> <span class="o">=</span> <span class="s">"One"</span>

    <span class="k">def</span> <span class="nf">build_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="s">"Big"</span>


<span class="k">class</span> <span class="nc">Flat</span><span class="p">(</span><span class="n">Building</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">build_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">floor</span> <span class="o">=</span> <span class="s">"More than One"</span>

    <span class="k">def</span> <span class="nf">build_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="s">"Small"</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">house</span> <span class="o">=</span> <span class="n">House</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">house</span>
<span class="n">Floor</span><span class="p">:</span> <span class="n">One</span> <span class="o">|</span> <span class="n">Size</span><span class="p">:</span> <span class="n">Big</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">flat</span> <span class="o">=</span> <span class="n">Flat</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">flat</span>
<span class="n">Floor</span><span class="p">:</span> <span class="n">More</span> <span class="n">than</span> <span class="n">One</span> <span class="o">|</span> <span class="n">Size</span><span class="p">:</span> <span class="n">Small</span>
</code></pre></div></div>

<h3 id="factory">Factory</h3>

<p>Объект для создания других объектов</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/creational/factory.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GreekLocalizer</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">translations</span> <span class="o">=</span> <span class="p">{</span><span class="s">"dog"</span><span class="p">:</span> <span class="s">"σκύλος"</span><span class="p">,</span> <span class="s">"cat"</span><span class="p">:</span> <span class="s">"γάτα"</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">localize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""We'll punt if we don't have a translation"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">translations</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EnglishLocalizer</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">localize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">msg</span>


<span class="k">def</span> <span class="nf">get_localizer</span><span class="p">(</span><span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"English"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>

    <span class="n">localizers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"English"</span><span class="p">:</span> <span class="n">EnglishLocalizer</span><span class="p">,</span>
        <span class="s">"Greek"</span><span class="p">:</span> <span class="n">GreekLocalizer</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">localizers</span><span class="p">[</span><span class="n">language</span><span class="p">]()</span>


<span class="c1"># Create our localizers
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">e</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">get_localizer</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s">"English"</span><span class="p">),</span> <span class="n">get_localizer</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s">"Greek"</span><span class="p">)</span>
<span class="c1"># Localize some text
</span><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="s">"dog parrot cat bear"</span><span class="p">.</span><span class="n">split</span><span class="p">():</span>
<span class="p">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">localize</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">g</span><span class="p">.</span><span class="n">localize</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
<span class="n">dog</span> <span class="n">σκύλος</span>
<span class="n">parrot</span> <span class="n">parrot</span>
<span class="n">cat</span> <span class="n">γάτα</span>
<span class="n">bear</span> <span class="n">bear</span>
</code></pre></div></div>

<h3 id="abstract-factory">Abstract Factory</h3>

<p>Реализует интерфейцс создлания связанного/зависимого объекта без непосредственного определения его класса. Идея - абстрагированное создание объектов в зависимсоти от бизнес-логики с определенным поведением. В python это можно сделать на [<a href="abc" title="Abc">abc</a>]</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/creational/abstract_factory.py">Пример без abc</a></p>

<h3 id="borg-monostate-pattern">Borg (Monostate pattern)</h3>

<p>Синеглтон с общим состоянием инстансев. Порождает несколько экземпляров, разделяющих общее состояние.</p>

<p>В python атрибут инстанса сохраняется в <code class="language-plaintext highlighter-rouge">__dict__</code> и каждый инстанс имеет свой собственный <code class="language-plaintext highlighter-rouge">__dict__</code>. Мы можем внести в эти словари изменеения или полностью переопределить их, чтобы поведение экзепляров отвечало нашим задачам.</p>

<p>Используется, к примеру, для управления коннектом к БД.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/creational/borg.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Borg</span><span class="p">:</span>
    <span class="n">_shared_state</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_shared_state</span>


<span class="k">class</span> <span class="nc">YourBorg</span><span class="p">(</span><span class="n">Borg</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># initiate the first instance with default state
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">"state"</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">"Init"</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">state</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">rm1</span> <span class="o">=</span> <span class="n">YourBorg</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rm2</span> <span class="o">=</span> <span class="n">YourBorg</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rm1</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">'Idle'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rm2</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">'Running'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm1: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm1</span><span class="p">))</span>
<span class="n">rm1</span><span class="p">:</span> <span class="n">Running</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm2: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm2</span><span class="p">))</span>
<span class="n">rm2</span><span class="p">:</span> <span class="n">Running</span>
<span class="c1"># When the `state` attribute is modified from instance `rm2`,
# the value of `state` in instance `rm1` also changes
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">rm2</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">'Zombie'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm1: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm1</span><span class="p">))</span>
<span class="n">rm1</span><span class="p">:</span> <span class="n">Zombie</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm2: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm2</span><span class="p">))</span>
<span class="n">rm2</span><span class="p">:</span> <span class="n">Zombie</span>
<span class="c1"># Even though `rm1` and `rm2` share attributes, the instances are not the same
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">rm1</span> <span class="ow">is</span> <span class="n">rm2</span>
<span class="bp">False</span>
<span class="c1"># New instances also get the same shared state
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">rm3</span> <span class="o">=</span> <span class="n">YourBorg</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm1: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm1</span><span class="p">))</span>
<span class="n">rm1</span><span class="p">:</span> <span class="n">Zombie</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm2: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm2</span><span class="p">))</span>
<span class="n">rm2</span><span class="p">:</span> <span class="n">Zombie</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm3: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm3</span><span class="p">))</span>
<span class="n">rm3</span><span class="p">:</span> <span class="n">Zombie</span>
<span class="c1"># A new instance can explicitly change the state during creation
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">rm4</span> <span class="o">=</span> <span class="n">YourBorg</span><span class="p">(</span><span class="s">'Running'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm4: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm4</span><span class="p">))</span>
<span class="n">rm4</span><span class="p">:</span> <span class="n">Running</span>
<span class="c1"># Existing instances reflect that change as well
</span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'rm3: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rm3</span><span class="p">))</span>
<span class="n">rm3</span><span class="p">:</span> <span class="n">Running</span>
</code></pre></div></div>

<h3 id="lazy-evaluation-ленивые-вычисления-property-pattern">Lazy evaluation (ленивые вычисления) property pattern</h3>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/creational/lazy_evaluation.py">Пример</a></p>

<h3 id="pool">Pool</h3>

<p>Создание и поддержание группы экземпларов одного типа. Используется когджа создавать объект затратно, но надо создавать часто. При этом мы понимаем, что одновременно задейстивыовано лишь несколько объектов из пула.</p>

<p>Pool может кешировать экземпляры и отдавать их по требованию, избегая дорогостоящего создания. Если в пуле пусто - создается новый объект.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/creational/pool.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ObjectPool</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">auto_get</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_queue</span> <span class="o">=</span> <span class="n">queue</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_queue</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="k">if</span> <span class="n">auto_get</span> <span class="k">else</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">item</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_queue</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">item</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_queue</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">item</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_queue</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">item</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="bp">None</span>


<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">queue</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test_object</span><span class="p">(</span><span class="n">queue</span><span class="p">):</span>
<span class="p">...</span>    <span class="n">pool</span> <span class="o">=</span> <span class="n">ObjectPool</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Inside func: {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">item</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sample_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">Queue</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sample_queue</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">'yam'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">ObjectPool</span><span class="p">(</span><span class="n">sample_queue</span><span class="p">)</span> <span class="k">as</span> <span class="n">obj</span><span class="p">:</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Inside with: {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
<span class="n">Inside</span> <span class="k">with</span><span class="p">:</span> <span class="n">yam</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'Outside with: {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sample_queue</span><span class="p">.</span><span class="n">get</span><span class="p">()))</span>
<span class="n">Outside</span> <span class="k">with</span><span class="p">:</span> <span class="n">yam</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sample_queue</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">'sam'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">test_object</span><span class="p">(</span><span class="n">sample_queue</span><span class="p">)</span>
<span class="n">Inside</span> <span class="n">func</span><span class="p">:</span> <span class="n">sam</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'Outside func: {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sample_queue</span><span class="p">.</span><span class="n">get</span><span class="p">()))</span>
<span class="n">Outside</span> <span class="n">func</span><span class="p">:</span> <span class="n">sam</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">sample_queue</span><span class="p">.</span><span class="n">empty</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sample_queue</span><span class="p">.</span><span class="n">get</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="prototype">Prototype</h3>

<p>Используется фабрика, которая возвращает клон прототипа, если создавать экземпляры дорого.</p>

<p>Сокращает количество сабклассов - вместо этого создаются объекты за счет копирования прототипа во время выполнения.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/creational/prototype.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>


<span class="k">class</span> <span class="nc">Prototype</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"default"</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prototype</span><span class="p">:</span>
        <span class="s">"""Clone a prototype and update inner attributes dictionary"""</span>
        <span class="c1"># Python in Practice, Mark Summerfield
</span>        <span class="c1"># copy.deepcopy can be used instead of next line.
</span>        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>


<span class="k">class</span> <span class="nc">PrototypeDispatcher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_objects</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Prototype</span><span class="p">]:</span>
        <span class="s">"""Get all objects"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_objects</span>

    <span class="k">def</span> <span class="nf">register_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Prototype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="s">"""Register an object"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">unregister_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="s">"""Unregister an object"""</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">PrototypeDispatcher</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">prototype</span> <span class="o">=</span> <span class="n">Prototype</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">prototype</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">prototype</span><span class="p">.</span><span class="n">clone</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">'a-value'</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">'a'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">clone</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">'b-value'</span><span class="p">,</span> <span class="n">is_checked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dispatcher</span><span class="p">.</span><span class="n">register_object</span><span class="p">(</span><span class="s">'objecta'</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dispatcher</span><span class="p">.</span><span class="n">register_object</span><span class="p">(</span><span class="s">'objectb'</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dispatcher</span><span class="p">.</span><span class="n">register_object</span><span class="p">(</span><span class="s">'default'</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[{</span><span class="n">n</span><span class="p">:</span> <span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">}</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">dispatcher</span><span class="p">.</span><span class="n">get_objects</span><span class="p">().</span><span class="n">items</span><span class="p">()]</span>
<span class="p">[{</span><span class="s">'objecta'</span><span class="p">:</span> <span class="s">'a-value'</span><span class="p">},</span> <span class="p">{</span><span class="s">'objectb'</span><span class="p">:</span> <span class="s">'b-value'</span><span class="p">},</span> <span class="p">{</span><span class="s">'default'</span><span class="p">:</span> <span class="s">'default'</span><span class="p">}]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">is_checked</span><span class="p">)</span>
<span class="n">a</span> <span class="bp">True</span>
</code></pre></div></div>

<h2 id="структурные-паттерны">Структурные паттерны</h2>

<h3 id="3-iter">3-iter</h3>

<p>Разделяет представлоение, процессинг приложения и менеджмент данных</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/3-tier.py">Простенький пример</a> (на самом деле разделение на слои в приложениях реализуются как минимум в модулях)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">KeysView</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>


<span class="k">class</span> <span class="nc">Data</span><span class="p">:</span>

    <span class="n">products</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"milk"</span><span class="p">:</span> <span class="p">{</span><span class="s">"price"</span><span class="p">:</span> <span class="mf">1.50</span><span class="p">,</span> <span class="s">"quantity"</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="s">"eggs"</span><span class="p">:</span> <span class="p">{</span><span class="s">"price"</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span> <span class="s">"quantity"</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
        <span class="s">"cheese"</span><span class="p">:</span> <span class="p">{</span><span class="s">"price"</span><span class="p">:</span> <span class="mf">2.00</span><span class="p">,</span> <span class="s">"quantity"</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">klas</span><span class="p">):</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"(Fetching from Data Store)"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"products"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">products</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">BusinessLogic</span><span class="p">:</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">product_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeysView</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="s">"products"</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">product_information</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="s">"products"</span><span class="p">].</span><span class="n">get</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Ui</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">business_logic</span> <span class="o">=</span> <span class="n">BusinessLogic</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_product_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"PRODUCT LIST:"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">business_logic</span><span class="p">.</span><span class="n">product_list</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_product_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">product_info</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">business_logic</span><span class="p">.</span><span class="n">product_information</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">product_info</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"PRODUCT INFORMATION:"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">f"Name: </span><span class="si">{</span><span class="n">product</span><span class="p">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s">, "</span>
                <span class="o">+</span> <span class="s">f"Price: </span><span class="si">{</span><span class="n">product_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'price'</span><span class="p">,</span> <span class="mi">0</span><span class="p">):.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">, "</span>
                <span class="o">+</span> <span class="s">f"Quantity: </span><span class="si">{</span><span class="n">product_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'quantity'</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span><span class="si">}</span><span class="s">"</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">f"That product '</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s">' does not exist in the records"</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">Ui</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ui</span><span class="p">.</span><span class="n">get_product_list</span><span class="p">()</span>
<span class="n">PRODUCT</span> <span class="n">LIST</span><span class="p">:</span>
<span class="p">(</span><span class="n">Fetching</span> <span class="k">from</span> <span class="n">Data</span> <span class="n">Store</span><span class="p">)</span>
<span class="n">milk</span>
<span class="n">eggs</span>
<span class="n">cheese</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ui</span><span class="p">.</span><span class="n">get_product_information</span><span class="p">(</span><span class="s">"cheese"</span><span class="p">)</span>
<span class="p">(</span><span class="n">Fetching</span> <span class="k">from</span> <span class="n">Data</span> <span class="n">Store</span><span class="p">)</span>
<span class="n">PRODUCT</span> <span class="n">INFORMATION</span><span class="p">:</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">Cheese</span><span class="p">,</span> <span class="n">Price</span><span class="p">:</span> <span class="mf">2.00</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">:</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ui</span><span class="p">.</span><span class="n">get_product_information</span><span class="p">(</span><span class="s">"eggs"</span><span class="p">)</span>
<span class="p">(</span><span class="n">Fetching</span> <span class="k">from</span> <span class="n">Data</span> <span class="n">Store</span><span class="p">)</span>
<span class="n">PRODUCT</span> <span class="n">INFORMATION</span><span class="p">:</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">Eggs</span><span class="p">,</span> <span class="n">Price</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">:</span> <span class="mi">100</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ui</span><span class="p">.</span><span class="n">get_product_information</span><span class="p">(</span><span class="s">"milk"</span><span class="p">)</span>
<span class="p">(</span><span class="n">Fetching</span> <span class="k">from</span> <span class="n">Data</span> <span class="n">Store</span><span class="p">)</span>
<span class="n">PRODUCT</span> <span class="n">INFORMATION</span><span class="p">:</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">Milk</span><span class="p">,</span> <span class="n">Price</span><span class="p">:</span> <span class="mf">1.50</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">:</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ui</span><span class="p">.</span><span class="n">get_product_information</span><span class="p">(</span><span class="s">"arepas"</span><span class="p">)</span>
<span class="p">(</span><span class="n">Fetching</span> <span class="k">from</span> <span class="n">Data</span> <span class="n">Store</span><span class="p">)</span>
<span class="n">That</span> <span class="n">product</span> <span class="s">'arepas'</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">records</span>
</code></pre></div></div>

<h3 id="adapter">Adapter</h3>

<p>Адаптирует один интерфейс к другому. Полезен для интеграции классов, которые несовместимы напрямую из-за разных интерфейсов.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/adapter.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s">"T"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dog</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Dog"</span>

    <span class="k">def</span> <span class="nf">bark</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"woof!"</span>


<span class="k">class</span> <span class="nc">Cat</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Cat"</span>

    <span class="k">def</span> <span class="nf">meow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"meow!"</span>


<span class="k">class</span> <span class="nc">Human</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Human"</span>

    <span class="k">def</span> <span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"'hello'"</span>


<span class="k">class</span> <span class="nc">Car</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Car"</span>

    <span class="k">def</span> <span class="nf">make_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octane_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">f"vroom</span><span class="si">{</span><span class="s">'!'</span> <span class="o">*</span> <span class="n">octane_level</span><span class="si">}</span><span class="s">"</span>


<span class="k">class</span> <span class="nc">Adapter</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">adapted_methods</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
        <span class="s">"""We set the adapted methods in the object's dict."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">adapted_methods</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="s">"""All non-adapted calls are passed to the object."""</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">original_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">obj</span><span class="p">.</span><span class="n">__dict__</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dog</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">dog</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>
<span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Dog'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">objects</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">dog</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="n">dog</span><span class="p">.</span><span class="n">bark</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">__dict__</span><span class="p">[</span><span class="s">'obj'</span><span class="p">],</span> <span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">__dict__</span><span class="p">[</span><span class="s">'make_noise'</span><span class="p">]</span>
<span class="p">(</span><span class="o">&lt;</span><span class="p">...</span><span class="n">Dog</span> <span class="nb">object</span> <span class="n">at</span> <span class="mi">0</span><span class="n">x</span><span class="p">...</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">Dog</span><span class="p">.</span><span class="n">bark</span> <span class="n">of</span> <span class="o">&lt;</span><span class="p">...</span><span class="n">Dog</span> <span class="nb">object</span> <span class="n">at</span> <span class="mi">0</span><span class="n">x</span><span class="p">...</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">original_dict</span><span class="p">())</span>
<span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Dog'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cat</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">objects</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="n">cat</span><span class="p">.</span><span class="n">meow</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">human</span> <span class="o">=</span> <span class="n">Human</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">objects</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">human</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="n">human</span><span class="p">.</span><span class="n">speak</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">objects</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">car</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">car</span><span class="p">.</span><span class="n">make_noise</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="s">"A {0} goes {1}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">make_noise</span><span class="p">()))</span>
<span class="n">A</span> <span class="n">Dog</span> <span class="n">goes</span> <span class="n">woof</span><span class="err">!</span>
<span class="n">A</span> <span class="n">Cat</span> <span class="n">goes</span> <span class="n">meow</span><span class="err">!</span>
<span class="n">A</span> <span class="n">Human</span> <span class="n">goes</span> <span class="s">'hello'</span>
<span class="n">A</span> <span class="n">Car</span> <span class="n">goes</span> <span class="n">vroom</span><span class="err">!!!</span>
</code></pre></div></div>

<h3 id="bridge">Bridge</h3>

<p>Отделяет абстракцию от реализации</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/bridge.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ConcreteImplementor 1/2
</span><span class="k">class</span> <span class="nc">DrawingAPI1</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"API1.circle at </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s"> radius </span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="c1"># ConcreteImplementor 2/2
</span><span class="k">class</span> <span class="nc">DrawingAPI2</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"API2.circle at </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s"> radius </span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="c1"># Refined Abstraction
</span><span class="k">class</span> <span class="nc">CircleShape</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">drawing_api</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_drawing_api</span> <span class="o">=</span> <span class="n">drawing_api</span>

    <span class="c1"># low-level i.e. Implementation specific
</span>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_drawing_api</span><span class="p">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_y</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_radius</span><span class="p">)</span>

    <span class="c1"># high-level i.e. Abstraction specific
</span>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pct</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_radius</span> <span class="o">*=</span> <span class="n">pct</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">shapes</span> <span class="o">=</span> <span class="p">(</span><span class="n">CircleShape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">DrawingAPI1</span><span class="p">()),</span> <span class="n">CircleShape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">DrawingAPI2</span><span class="p">()))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
<span class="p">...</span>    <span class="n">shape</span><span class="p">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
<span class="p">...</span>    <span class="n">shape</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">API1</span><span class="p">.</span><span class="n">circle</span> <span class="n">at</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="n">radius</span> <span class="mf">7.5</span>
<span class="n">API2</span><span class="p">.</span><span class="n">circle</span> <span class="n">at</span> <span class="mi">5</span><span class="p">:</span><span class="mi">7</span> <span class="n">radius</span> <span class="mf">27.5</span>
</code></pre></div></div>

<h3 id="composite">Composite</h3>

<p>Позволяет клиентам одинаково воспринимать отдельные объекты и их композиции. Шаблон обрабатывает группу объектов как один экземпляр объекта того же типа.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/composite.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<span class="k">class</span> <span class="nc">Graphic</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span><span class="p">(</span><span class="s">"You should implement this!"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CompositeGraphic</span><span class="p">(</span><span class="n">Graphic</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">graphics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Graphic</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">graphic</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">graphics</span><span class="p">:</span>
            <span class="n">graphic</span><span class="p">.</span><span class="n">render</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graphic</span><span class="p">:</span> <span class="n">Graphic</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">graphics</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphic</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graphic</span><span class="p">:</span> <span class="n">Graphic</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">graphics</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">graphic</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Ellipse</span><span class="p">(</span><span class="n">Graphic</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"Ellipse: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">ellipse1</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ellipse2</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="s">"2"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ellipse3</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="s">"3"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ellipse4</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="s">"4"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic1</span> <span class="o">=</span> <span class="n">CompositeGraphic</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic2</span> <span class="o">=</span> <span class="n">CompositeGraphic</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">ellipse1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">ellipse2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">ellipse3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic2</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">ellipse4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic</span> <span class="o">=</span> <span class="n">CompositeGraphic</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">graphic1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">graphic2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">graphic</span><span class="p">.</span><span class="n">render</span><span class="p">()</span>
<span class="n">Ellipse</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Ellipse</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Ellipse</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Ellipse</span><span class="p">:</span> <span class="mi">4</span>
</code></pre></div></div>

<h3 id="decorator">Decorator</h3>

<p>Реализует обертку над объектом, обспечивая дополнительное поведение. В python можно использовать [<a href="python-decorator" title="Python decorator">python-decorator</a>]</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/decorator.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TextTag</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_text</span>


<span class="k">class</span> <span class="nc">BoldWrapper</span><span class="p">(</span><span class="n">TextTag</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_wrapped</span> <span class="o">=</span> <span class="n">wrapped</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">f"&lt;b&gt;</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">_wrapped</span><span class="p">.</span><span class="n">render</span><span class="p">()</span><span class="si">}</span><span class="s">&lt;/b&gt;"</span>


<span class="k">class</span> <span class="nc">ItalicWrapper</span><span class="p">(</span><span class="n">TextTag</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_wrapped</span> <span class="o">=</span> <span class="n">wrapped</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">f"&lt;i&gt;</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">_wrapped</span><span class="p">.</span><span class="n">render</span><span class="p">()</span><span class="si">}</span><span class="s">&lt;/i&gt;"</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">simple_hello</span> <span class="o">=</span> <span class="n">TextTag</span><span class="p">(</span><span class="s">"hello, world!"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">special_hello</span> <span class="o">=</span> <span class="n">ItalicWrapper</span><span class="p">(</span><span class="n">BoldWrapper</span><span class="p">(</span><span class="n">simple_hello</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">"before:"</span><span class="p">,</span> <span class="n">simple_hello</span><span class="p">.</span><span class="n">render</span><span class="p">())</span>
<span class="n">before</span><span class="p">:</span> <span class="n">hello</span><span class="p">,</span> <span class="n">world</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">"after:"</span><span class="p">,</span> <span class="n">special_hello</span><span class="p">.</span><span class="n">render</span><span class="p">())</span>
<span class="n">after</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">i</span><span class="o">&gt;&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">hello</span><span class="p">,</span> <span class="n">world</span><span class="err">!</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;&lt;/</span><span class="n">i</span><span class="o">&gt;</span>
</code></pre></div></div>

<h3 id="facade">Facade</h3>

<p>Один класс используется как API для группы других классов. Предоставляет обобщенный и унифицированный интерфейс для более сложных систем.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/facade.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CPU</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">freeze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Freezing processor."</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">jump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Jumping to:"</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Executing."</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Memory</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"Loading from </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s"> data: '</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s">'."</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SolidStateDrive</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lba</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">f"Some data from sector </span><span class="si">{</span><span class="n">lba</span><span class="si">}</span><span class="s"> with size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s">"</span>


<span class="k">class</span> <span class="nc">ComputerFacade</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="n">CPU</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">Memory</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ssd</span> <span class="o">=</span> <span class="n">SolidStateDrive</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">freeze</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">memory</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">"0x00"</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">ssd</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="s">"100"</span><span class="p">,</span> <span class="s">"1024"</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">jump</span><span class="p">(</span><span class="s">"0x00"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">execute</span><span class="p">()</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">computer_facade</span> <span class="o">=</span> <span class="n">ComputerFacade</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">computer_facade</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">Freezing</span> <span class="n">processor</span><span class="p">.</span>
<span class="n">Loading</span> <span class="k">from</span> <span class="mh">0x00</span> <span class="n">data</span><span class="p">:</span> <span class="s">'Some data from sector 100 with size 1024'</span><span class="p">.</span>
<span class="n">Jumping</span> <span class="n">to</span><span class="p">:</span> <span class="mh">0x00</span>
<span class="n">Executing</span><span class="p">.</span>
</code></pre></div></div>

<h3 id="fly-weight-приспособленецй">Fly weight (приспособленецй)</h3>

<p>Позволяет прозрачно повторно использовать уже созданные экзепляры объектов с похожими/идентичными состояниями</p>

<p>Направлен на минимизацию количества объектов, которые нужны приложению во время выполнения. Шаблон производит объекты, которые используется одновременно несколькими контейнерами.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/flyweight.py">Пример</a></p>

<h3 id="front-controller">Front controller</h3>

<p>Разделяет логику клиента и объекта, предоставляющего данные, что позволяет контроллировать поведение</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/front_controller.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MobileView</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">show_index_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Displaying mobile index page"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TabletView</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">show_index_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Displaying tablet index page"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dispatcher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mobile_view</span> <span class="o">=</span> <span class="n">MobileView</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tablet_view</span> <span class="o">=</span> <span class="n">TabletView</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">Request</span><span class="p">.</span><span class="n">mobile_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">mobile_view</span><span class="p">.</span><span class="n">show_index_page</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">request</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">Request</span><span class="p">.</span><span class="n">tablet_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tablet_view</span><span class="p">.</span><span class="n">show_index_page</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Cannot dispatch the request"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RequestController</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">Dispatcher</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Request</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"request must be a Request object"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>

    <span class="n">mobile_type</span> <span class="o">=</span> <span class="s">"mobile"</span>
    <span class="n">tablet_type</span> <span class="o">=</span> <span class="s">"tablet"</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">mobile_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">mobile_type</span>
        <span class="k">elif</span> <span class="n">request</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">tablet_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">tablet_type</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">front_controller</span> <span class="o">=</span> <span class="n">RequestController</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">front_controller</span><span class="p">.</span><span class="n">dispatch_request</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="s">'mobile'</span><span class="p">))</span>
<span class="n">Displaying</span> <span class="n">mobile</span> <span class="n">index</span> <span class="n">page</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">front_controller</span><span class="p">.</span><span class="n">dispatch_request</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="s">'tablet'</span><span class="p">))</span>
<span class="n">Displaying</span> <span class="n">tablet</span> <span class="n">index</span> <span class="n">page</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">front_controller</span><span class="p">.</span><span class="n">dispatch_request</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="s">'desktop'</span><span class="p">))</span>
<span class="n">Cannot</span> <span class="n">dispatch</span> <span class="n">the</span> <span class="n">request</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">front_controller</span><span class="p">.</span><span class="n">dispatch_request</span><span class="p">(</span><span class="s">'mobile'</span><span class="p">)</span>
<span class="n">request</span> <span class="n">must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">Request</span> <span class="nb">object</span>
</code></pre></div></div>

<h3 id="mvc-model-view-controller">Mvc (model-&gt;view-&gt;controller)</h3>

<p>Расширяет предыдущую модель. <a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/mvc.py">Пример</a> с использованием [<a href="abc" title="Abc">abc</a>]</p>

<h3 id="proxy">Proxy</h3>

<p>Объект передает операции кому-то еще. Прокси используется там, где надо добавить в класс функциональность, не меняя его (например добавление журналирования, кешировавния, авторизацию и т.д.)</p>

<p>Субъекты и прокси в паттерне требуют реализации одинаковых интерфейсов.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/structural/proxy.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>


<span class="k">class</span> <span class="nc">Subject</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">do_the_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">RealSubject</span><span class="p">(</span><span class="n">Subject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">do_the_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"I am doing the job for </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Proxy</span><span class="p">(</span><span class="n">Subject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_real_subject</span> <span class="o">=</span> <span class="n">RealSubject</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">do_the_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"[log] Doing the job for </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> is requested."</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user</span> <span class="o">==</span> <span class="s">"admin"</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_real_subject</span><span class="p">.</span><span class="n">do_the_job</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[log] I can do the job just for `admins`."</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="n">job_doer</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">RealSubject</span><span class="p">,</span> <span class="n">Proxy</span><span class="p">],</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">job_doer</span><span class="p">.</span><span class="n">do_the_job</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">real_subject</span> <span class="o">=</span> <span class="n">RealSubject</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">)</span>
<span class="p">[</span><span class="n">log</span><span class="p">]</span> <span class="n">Doing</span> <span class="n">the</span> <span class="n">job</span> <span class="k">for</span> <span class="n">admin</span> <span class="ow">is</span> <span class="n">requested</span><span class="p">.</span>
<span class="n">I</span> <span class="n">am</span> <span class="n">doing</span> <span class="n">the</span> <span class="n">job</span> <span class="k">for</span> <span class="n">admin</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="s">'anonymous'</span><span class="p">)</span>
<span class="p">[</span><span class="n">log</span><span class="p">]</span> <span class="n">Doing</span> <span class="n">the</span> <span class="n">job</span> <span class="k">for</span> <span class="n">anonymous</span> <span class="ow">is</span> <span class="n">requested</span><span class="p">.</span>
<span class="p">[</span><span class="n">log</span><span class="p">]</span> <span class="n">I</span> <span class="n">can</span> <span class="n">do</span> <span class="n">the</span> <span class="n">job</span> <span class="n">just</span> <span class="k">for</span> <span class="sb">`admins`</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="p">(</span><span class="n">real_subject</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">)</span>
<span class="n">I</span> <span class="n">am</span> <span class="n">doing</span> <span class="n">the</span> <span class="n">job</span> <span class="k">for</span> <span class="n">admin</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="p">(</span><span class="n">real_subject</span><span class="p">,</span> <span class="s">'anonymous'</span><span class="p">)</span>
<span class="n">I</span> <span class="n">am</span> <span class="n">doing</span> <span class="n">the</span> <span class="n">job</span> <span class="k">for</span> <span class="n">anonymous</span>
</code></pre></div></div>

<h2 id="поведенческие-паттерны">Поведенческие паттерны</h2>

<h3 id="chaining-method">Chaining method</h3>

<p>Продолжимть выполнение операций обратным вызовом следующего метода</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/chaining_method.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>


<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Action</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">do_action</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Action</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">action</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">" "</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">action</span>


<span class="k">class</span> <span class="nc">Action</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Action</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">" "</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"then stop"</span><span class="p">)</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">move</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="s">'move'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s">'Jack'</span><span class="p">,</span> <span class="n">move</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">person</span><span class="p">.</span><span class="n">do_action</span><span class="p">().</span><span class="n">amount</span><span class="p">(</span><span class="s">'5m'</span><span class="p">).</span><span class="n">stop</span><span class="p">()</span>
<span class="n">Jack</span> <span class="n">move</span> <span class="mi">5</span><span class="n">m</span> <span class="n">then</span> <span class="n">stop</span>
</code></pre></div></div>

<h3 id="chain-of-responsibility">Chain of responsibility</h3>

<p>Цепочка последовательнывх обработчиков. (if… elif…elif…else)</p>

<p>Блоки могут быть переставлены реконфигурированы во время выполнения. Отделяет отправителя запроса от принимающего. Принимающий знает только последнего отправителя.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/chain_of_responsibility.py">Пример</a></p>

<h3 id="catalog">Catalog</h3>

<p>Обобщенный метод вызывает специальные методы, основываясь на параметре состояния.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/catalog.py">Пример (и примеры других реализаций)</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Catalog</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_static_method_choices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"param_value_1"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">_static_method_1</span><span class="p">,</span>
            <span class="s">"param_value_2"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">_static_method_2</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># simple test to validate param value
</span>        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">_static_method_choices</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">param</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">f"Invalid Value for Param: </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">_static_method_1</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"executed method 1!"</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">_static_method_2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"executed method 2!"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">main_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_static_method_choices</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">param</span><span class="p">]()</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">test</span> <span class="o">=</span> <span class="n">Catalog</span><span class="p">(</span><span class="s">'param_value_2'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">test</span><span class="p">.</span><span class="n">main_method</span><span class="p">()</span>
<span class="n">executed</span> <span class="n">method</span> <span class="mi">2</span><span class="err">!</span>
</code></pre></div></div>

<h3 id="command">Command</h3>

<p>Создаем бандл из аргументов и методов для вызова позже.</p>

<p>Отделяет объект, выдающий задачу от того, кто знает как ее сделать.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/command.py">Пример</a> - пункты в меню, вызывающие один и тот же метод при нажатии.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>


<span class="k">class</span> <span class="nc">HideFileCommand</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># an array of files hidden, to undo them as needed
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_hidden_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"hiding </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_hidden_files</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_hidden_files</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"un-hiding </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DeleteFileCommand</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># an array of deleted files, to undo them as needed
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_deleted_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"deleting </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_deleted_files</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_deleted_files</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"restoring </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MenuItem</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">HideFileCommand</span><span class="p">,</span> <span class="n">DeleteFileCommand</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_command</span> <span class="o">=</span> <span class="n">command</span>

    <span class="k">def</span> <span class="nf">on_do_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_command</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_undo_press</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_command</span><span class="p">.</span><span class="n">undo</span><span class="p">()</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">item1</span> <span class="o">=</span> <span class="n">MenuItem</span><span class="p">(</span><span class="n">DeleteFileCommand</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">item2</span> <span class="o">=</span> <span class="n">MenuItem</span><span class="p">(</span><span class="n">HideFileCommand</span><span class="p">())</span>
<span class="c1"># create a file named `test-file` to work with
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">test_file_name</span> <span class="o">=</span> <span class="s">'test-file'</span>
<span class="c1"># deleting `test-file`
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">item1</span><span class="p">.</span><span class="n">on_do_press</span><span class="p">(</span><span class="n">test_file_name</span><span class="p">)</span>
<span class="n">deleting</span> <span class="n">test</span><span class="o">-</span><span class="nb">file</span>
<span class="c1"># restoring `test-file`
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">item1</span><span class="p">.</span><span class="n">on_undo_press</span><span class="p">()</span>
<span class="n">restoring</span> <span class="n">test</span><span class="o">-</span><span class="nb">file</span>
<span class="c1"># hiding `test-file`
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">item2</span><span class="p">.</span><span class="n">on_do_press</span><span class="p">(</span><span class="n">test_file_name</span><span class="p">)</span>
<span class="n">hiding</span> <span class="n">test</span><span class="o">-</span><span class="nb">file</span>
<span class="c1"># un-hiding `test-file`
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">item2</span><span class="p">.</span><span class="n">on_undo_press</span><span class="p">()</span>
<span class="n">un</span><span class="o">-</span><span class="n">hiding</span> <span class="n">test</span><span class="o">-</span><span class="nb">file</span>
</code></pre></div></div>

<h3 id="iterator">Iterator</h3>

<p>Пройти через контейнер и получить доступ к его элементам</p>

<p>В python итераторы реализуются на уровне маг.методов</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Count</span><span class="p">:</span>
    <span class="s">"""Iterator that counts upward forever"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">num</span>
</code></pre></div></div>

<p>смотри <a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/iterator_alt.py">другой пример</a></p>

<h3 id="mediator">Mediator</h3>

<p>Соединяет другие объекты в одном объекте и действует как прокси. Сокращает число связей в коде.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/mediator.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>


<span class="k">class</span> <span class="nc">ChatRoom</span><span class="p">:</span>
    <span class="s">"""Mediator class"""</span>

    <span class="k">def</span> <span class="nf">display_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"[</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> says]: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="s">"""A class whose instances want to interact with each other"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">chat_room</span> <span class="o">=</span> <span class="n">ChatRoom</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">chat_room</span><span class="p">.</span><span class="n">display_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">molly</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s">'Molly'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mark</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s">'Mark'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ethan</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s">'Ethan'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">molly</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Hi Team! Meeting at 3 PM today."</span><span class="p">)</span>
<span class="p">[</span><span class="n">Molly</span> <span class="n">says</span><span class="p">]:</span> <span class="n">Hi</span> <span class="n">Team</span><span class="err">!</span> <span class="n">Meeting</span> <span class="n">at</span> <span class="mi">3</span> <span class="n">PM</span> <span class="n">today</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mark</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Roger that!"</span><span class="p">)</span>
<span class="p">[</span><span class="n">Mark</span> <span class="n">says</span><span class="p">]:</span> <span class="n">Roger</span> <span class="n">that</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ethan</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Alright."</span><span class="p">)</span>
<span class="p">[</span><span class="n">Ethan</span> <span class="n">says</span><span class="p">]:</span> <span class="n">Alright</span><span class="p">.</span>
</code></pre></div></div>

<h3 id="memento">Memento</h3>

<p>Создает вложенный объект (как правило замыкание) - токен, который можно использовать для возврата другого объекта к предыдущему состоянию. <a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/memento.py">Пример</a></p>

<h3 id="observer-наблюдатель">Observer (наблюдатель)</h3>

<p>Обеспечивает обратный вызов для уведомления о событиях</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/observer.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">suppress</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span>


<span class="c1"># define a generic observer type
</span><span class="k">class</span> <span class="nc">Observer</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">Subject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Subject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_observers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Observer</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observer</span><span class="p">:</span> <span class="n">Observer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">observer</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">_observers</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_observers</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">observer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observer</span><span class="p">:</span> <span class="n">Observer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="nb">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_observers</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">observer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier</span><span class="p">:</span> <span class="n">Observer</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">observer</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">_observers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">!=</span> <span class="n">observer</span><span class="p">:</span>
                <span class="n">observer</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">Subject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_data</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_data</span>

    <span class="o">@</span><span class="n">data</span><span class="p">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">notify</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">HexViewer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">Data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"HexViewer: Subject </span><span class="si">{</span><span class="n">subject</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> has data 0x</span><span class="si">{</span><span class="n">subject</span><span class="p">.</span><span class="n">data</span><span class="p">:</span><span class="n">x</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DecimalViewer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">Data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"DecimalViewer: Subject </span><span class="si">{</span><span class="n">subject</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> has data </span><span class="si">{</span><span class="n">subject</span><span class="p">.</span><span class="n">data</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">data1</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">'Data 1'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">'Data 2'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">view1</span> <span class="o">=</span> <span class="n">DecimalViewer</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">view2</span> <span class="o">=</span> <span class="n">HexViewer</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data1</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">view1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data1</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">view2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data2</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">view2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data2</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">view1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data1</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">DecimalViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">1</span> <span class="n">has</span> <span class="n">data</span> <span class="mi">10</span>
<span class="n">HexViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">1</span> <span class="n">has</span> <span class="n">data</span> <span class="mh">0xa</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data2</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">HexViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">2</span> <span class="n">has</span> <span class="n">data</span> <span class="mh">0xf</span>
<span class="n">DecimalViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">2</span> <span class="n">has</span> <span class="n">data</span> <span class="mi">15</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data1</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">DecimalViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">1</span> <span class="n">has</span> <span class="n">data</span> <span class="mi">3</span>
<span class="n">HexViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">1</span> <span class="n">has</span> <span class="n">data</span> <span class="mh">0x3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data2</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">HexViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">2</span> <span class="n">has</span> <span class="n">data</span> <span class="mh">0x5</span>
<span class="n">DecimalViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">2</span> <span class="n">has</span> <span class="n">data</span> <span class="mi">5</span>
<span class="c1"># Detach HexViewer from data1 and data2
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">data1</span><span class="p">.</span><span class="n">detach</span><span class="p">(</span><span class="n">view2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data2</span><span class="p">.</span><span class="n">detach</span><span class="p">(</span><span class="n">view2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data1</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">DecimalViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">1</span> <span class="n">has</span> <span class="n">data</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data2</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">DecimalViewer</span><span class="p">:</span> <span class="n">Subject</span> <span class="n">Data</span> <span class="mi">2</span> <span class="n">has</span> <span class="n">data</span> <span class="mi">15</span>
</code></pre></div></div>

<h3 id="publish-subscribe">Publish subscribe</h3>

<p>Источник данных аккумулирует и рассылает данные для неопределенного круга подписчиков</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/publish_subscribe.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Provider</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">msg_queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">subscribers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">msg_queue</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">subscriber</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">subscribers</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">[]).</span><span class="n">append</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unsubscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">subscriber</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">subscribers</span><span class="p">[</span><span class="n">msg</span><span class="p">].</span><span class="n">remove</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">msg_queue</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">subscribers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">sub</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">msg_queue</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">class</span> <span class="nc">Publisher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_center</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">provider</span> <span class="o">=</span> <span class="n">msg_center</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">provider</span><span class="p">.</span><span class="n">notify</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Subscriber</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">msg_center</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">provider</span> <span class="o">=</span> <span class="n">msg_center</span>

    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">provider</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unsubscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">provider</span><span class="p">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> got </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">message_center</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="n">message_center</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jim</span> <span class="o">=</span> <span class="n">Subscriber</span><span class="p">(</span><span class="s">"jim"</span><span class="p">,</span> <span class="n">message_center</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jim</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"cartoon"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jack</span> <span class="o">=</span> <span class="n">Subscriber</span><span class="p">(</span><span class="s">"jack"</span><span class="p">,</span> <span class="n">message_center</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jack</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"music"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">gee</span> <span class="o">=</span> <span class="n">Subscriber</span><span class="p">(</span><span class="s">"gee"</span><span class="p">,</span> <span class="n">message_center</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">gee</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"movie"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vani</span> <span class="o">=</span> <span class="n">Subscriber</span><span class="p">(</span><span class="s">"vani"</span><span class="p">,</span> <span class="n">message_center</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vani</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"movie"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vani</span><span class="p">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="s">"movie"</span><span class="p">)</span>
<span class="c1"># Note that no one subscribed to `ads`
# and that vani changed their mind
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"cartoon"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"music"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"ads"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"movie"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"cartoon"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"cartoon"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"movie"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fftv</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="s">"blank"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">message_center</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>
<span class="n">jim</span> <span class="n">got</span> <span class="n">cartoon</span>
<span class="n">jack</span> <span class="n">got</span> <span class="n">music</span>
<span class="n">gee</span> <span class="n">got</span> <span class="n">movie</span>
<span class="n">jim</span> <span class="n">got</span> <span class="n">cartoon</span>
<span class="n">jim</span> <span class="n">got</span> <span class="n">cartoon</span>
<span class="n">gee</span> <span class="n">got</span> <span class="n">movie</span>
</code></pre></div></div>

<h3 id="registry">Registry</h3>

<p>Позволяет отслеживать все подклассы исходного класса. Реализуется через метаклассы - смотри [<a href="abc" title="Abc">abc</a>]</p>

<p>Пример</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RegistryHolder</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>

    <span class="n">REGISTRY</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">new_cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="s">"""Here the name of the class is used as key but it could be any class
        parameter.
        """</span>
        <span class="n">cls</span><span class="p">.</span><span class="n">REGISTRY</span><span class="p">[</span><span class="n">new_cls</span><span class="p">.</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cls</span>
        <span class="k">return</span> <span class="n">new_cls</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">get_registry</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cls</span><span class="p">.</span><span class="n">REGISTRY</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseRegisteredClass</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">RegistryHolder</span><span class="p">):</span>
    <span class="s">"""Any class that will inherits from BaseRegisteredClass will be included
    inside the dict RegistryHolder.REGISTRY, the key being the name of the
    class and the associated value, the class itself.
    """</span>


<span class="c1"># Before subclassing
</span><span class="o">&gt;&gt;&gt;</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">RegistryHolder</span><span class="p">.</span><span class="n">REGISTRY</span><span class="p">)</span>
<span class="p">[</span><span class="s">'BaseRegisteredClass'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">ClassRegistree</span><span class="p">(</span><span class="n">BaseRegisteredClass</span><span class="p">):</span>
<span class="p">...</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="p">...</span>        <span class="k">pass</span>
<span class="c1"># After subclassing
</span><span class="o">&gt;&gt;&gt;</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">RegistryHolder</span><span class="p">.</span><span class="n">REGISTRY</span><span class="p">)</span>
<span class="p">[</span><span class="s">'BaseRegisteredClass'</span><span class="p">,</span> <span class="s">'ClassRegistree'</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="specification">Specification</h3>

<p>Бизнес логика может быть повторно использована с помощью рекомбенации и булевой логики.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/specification.py">Пример</a> реализуется чсерез [<a href="abc" title="Abc">abc</a>]</p>

<h3 id="state">State</h3>

<p>Реализация логики в виде дискретного числа потенциальных состояний и следующего состояния, в которое можно перейти.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/state.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
    <span class="s">"""Base state. This is to share functionality"""</span>

    <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Scan the dial to the next station"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">stations</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"Scanning... Station is </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">stations</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">]</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AmState</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radio</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">radio</span> <span class="o">=</span> <span class="n">radio</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stations</span> <span class="o">=</span> <span class="p">[</span><span class="s">"1250"</span><span class="p">,</span> <span class="s">"1380"</span><span class="p">,</span> <span class="s">"1510"</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"AM"</span>

    <span class="k">def</span> <span class="nf">toggle_amfm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Switching to FM"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">radio</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">radio</span><span class="p">.</span><span class="n">fmstate</span>


<span class="k">class</span> <span class="nc">FmState</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radio</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">radio</span> <span class="o">=</span> <span class="n">radio</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stations</span> <span class="o">=</span> <span class="p">[</span><span class="s">"81.3"</span><span class="p">,</span> <span class="s">"89.1"</span><span class="p">,</span> <span class="s">"103.9"</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"FM"</span>

    <span class="k">def</span> <span class="nf">toggle_amfm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Switching to AM"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">radio</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">radio</span><span class="p">.</span><span class="n">amstate</span>


<span class="k">class</span> <span class="nc">Radio</span><span class="p">:</span>
    <span class="s">"""A radio. It has a scan button, and an AM/FM toggle switch."""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""We have an AM state and an FM state"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amstate</span> <span class="o">=</span> <span class="n">AmState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fmstate</span> <span class="o">=</span> <span class="n">FmState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">amstate</span>

    <span class="k">def</span> <span class="nf">toggle_amfm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="n">toggle_amfm</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="n">scan</span><span class="p">()</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">radio</span> <span class="o">=</span> <span class="n">Radio</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">radio</span><span class="p">.</span><span class="n">scan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">radio</span><span class="p">.</span><span class="n">toggle_amfm</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">radio</span><span class="p">.</span><span class="n">scan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">actions</span> <span class="o">*=</span> <span class="mi">2</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
<span class="p">...</span>    <span class="n">action</span><span class="p">()</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mi">1380</span> <span class="n">AM</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mi">1510</span> <span class="n">AM</span>
<span class="n">Switching</span> <span class="n">to</span> <span class="n">FM</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mf">89.1</span> <span class="n">FM</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mf">103.9</span> <span class="n">FM</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mf">81.3</span> <span class="n">FM</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mf">89.1</span> <span class="n">FM</span>
<span class="n">Switching</span> <span class="n">to</span> <span class="n">AM</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mi">1250</span> <span class="n">AM</span>
<span class="n">Scanning</span><span class="p">...</span> <span class="n">Station</span> <span class="ow">is</span> <span class="mi">1380</span> <span class="n">AM</span>
</code></pre></div></div>

<p>Маленькая ремарка: на мой взгляд этот паттерн и несколько аналогичных вышеобозначенных, нежизнеспособны в python по ряду причин:</p>

<ul>
  <li>громоздкость</li>
  <li>росто сложности по мере роста числа реализаций</li>
  <li>плохая передача/наследование структурной информации между объектами на уровне кода (потребуется значительный объем работы для того, чтобы разобраться как это устроено). Особенно это заметно в данном примере</li>
</ul>

<h3 id="strategy">Strategy</h3>

<p>Реализует выбор операций над одними и теми же данными. Определяет семейство алгоритмов, инкапсулирует каждый из них и делает их взаимозаменяемыми. Стратегия позволяет алгоритму изменяться независимо от клиентов, которые его используют.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/strategy.py">Пример</a>. В данном примере реализован класс-валидатор и несколько дисконтных стратегий. Мы валидируем применеение стратегий, чтобы не допустить непримлемое снижение цены.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>


<span class="k">class</span> <span class="nc">DiscountStrategyValidator</span><span class="p">:</span>  <span class="c1"># Descriptor class for check perform
</span>    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Order</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">.</span><span class="n">price</span> <span class="o">-</span> <span class="n">value</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span>
                    <span class="s">f"Discount cannot be applied due to negative price resulting. </span><span class="si">{</span><span class="n">value</span><span class="p">.</span><span class="n">__name__</span><span class="si">}</span><span class="s">"</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="nb">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">private_name</span> <span class="o">=</span> <span class="s">f"_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">"</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Order</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">private_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">private_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">objtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">private_name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Order</span><span class="p">:</span>
    <span class="n">discount_strategy</span> <span class="o">=</span> <span class="n">DiscountStrategyValidator</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">discount_strategy</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">price</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">price</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">discount_strategy</span> <span class="o">=</span> <span class="n">discount_strategy</span>

    <span class="k">def</span> <span class="nf">apply_discount</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">discount_strategy</span><span class="p">:</span>
            <span class="n">discount</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">discount_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">discount</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">price</span> <span class="o">-</span> <span class="n">discount</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">f"&lt;Order price: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">price</span><span class="si">}</span><span class="s"> with discount strategy: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">discount_strategy</span><span class="p">,</span><span class="s">'__name__'</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="si">}</span><span class="s">&gt;"</span>


<span class="k">def</span> <span class="nf">ten_percent_discount</span><span class="p">(</span><span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">order</span><span class="p">.</span><span class="n">price</span> <span class="o">*</span> <span class="mf">0.10</span>


<span class="k">def</span> <span class="nf">on_sale_discount</span><span class="p">(</span><span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">order</span><span class="p">.</span><span class="n">price</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="mi">20</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">discount_strategy</span><span class="o">=</span><span class="n">ten_percent_discount</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Order</span> <span class="n">price</span><span class="p">:</span> <span class="mi">100</span> <span class="k">with</span> <span class="n">discount</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">ten_percent_discount</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="n">apply_discount</span><span class="p">())</span>
<span class="mf">90.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">discount_strategy</span><span class="o">=</span><span class="n">on_sale_discount</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Order</span> <span class="n">price</span><span class="p">:</span> <span class="mi">100</span> <span class="k">with</span> <span class="n">discount</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">on_sale_discount</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="n">apply_discount</span><span class="p">())</span>
<span class="mf">55.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">discount_strategy</span><span class="o">=</span><span class="n">on_sale_discount</span><span class="p">)</span>
<span class="n">Discount</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">applied</span> <span class="n">due</span> <span class="n">to</span> <span class="n">negative</span> <span class="n">price</span> <span class="n">resulting</span><span class="p">.</span> <span class="n">on_sale_discount</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Order</span> <span class="n">price</span><span class="p">:</span> <span class="mi">10</span> <span class="k">with</span> <span class="n">discount</span> <span class="n">strategy</span><span class="p">:</span> <span class="bp">None</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>В данном примере реализован дескриптор (смотри [<a href="python-descriptors" title="Python descriptors">python-descriptors</a>]).  <code class="language-plaintext highlighter-rouge">__set_name__</code> вызывается сразу после того, как определен класс-владелец. Затем, при создании экземпляра класса владельца функция расчета скидки вызывается первый раз, чтобы провалидировать ее параметры валидатором дескриптора и сохранить в дескрипторе объект функции для дальнейшего вызова. При вызове метода <code class="language-plaintext highlighter-rouge">apply_discount()</code> мы обращаемся к дескриптору, чтобы применить скидку или не сделать ничего.</p>

<h3 id="template">Template</h3>

<p>Объект определяет структуру и принимает подключаемые компоненты</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/template.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_text</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"plain-text"</span>


<span class="k">def</span> <span class="nf">get_pdf</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"pdf"</span>


<span class="k">def</span> <span class="nf">get_csv</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"csv"</span>


<span class="k">def</span> <span class="nf">convert_to_text</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[CONVERT]"</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">f"</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s"> as text"</span>


<span class="k">def</span> <span class="nf">saver</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[SAVE]"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">template_function</span><span class="p">(</span><span class="n">getter</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">to_save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">getter</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"Got `</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s">`"</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">converter</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">converter</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Skip conversion"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">to_save</span><span class="p">:</span>
        <span class="n">saver</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s">f"`</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s">` was processed"</span><span class="p">)</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">template_function</span><span class="p">(</span><span class="n">get_text</span><span class="p">,</span> <span class="n">to_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Got</span> <span class="sb">`plain-text`</span>
<span class="n">Skip</span> <span class="n">conversion</span>
<span class="p">[</span><span class="n">SAVE</span><span class="p">]</span>
<span class="sb">`plain-text`</span> <span class="n">was</span> <span class="n">processed</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">template_function</span><span class="p">(</span><span class="n">get_pdf</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="n">convert_to_text</span><span class="p">)</span>
<span class="n">Got</span> <span class="sb">`pdf`</span>
<span class="p">[</span><span class="n">CONVERT</span><span class="p">]</span>
<span class="sb">`pdf as text`</span> <span class="n">was</span> <span class="n">processed</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">template_function</span><span class="p">(</span><span class="n">get_csv</span><span class="p">,</span> <span class="n">to_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Got</span> <span class="sb">`csv`</span>
<span class="n">Skip</span> <span class="n">conversion</span>
<span class="p">[</span><span class="n">SAVE</span><span class="p">]</span>
<span class="sb">`csv`</span> <span class="n">was</span> <span class="n">processed</span>
</code></pre></div></div>

<h3 id="visitor-посетитель">Visitor (посетитель)</h3>

<p>Реализует обратный вызов для всех объектов коллекции</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/behavioral/visitor.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Visitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">meth</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__mro__</span><span class="p">:</span>
            <span class="n">meth_name</span> <span class="o">=</span> <span class="s">"visit_"</span> <span class="o">+</span> <span class="n">cls</span><span class="p">.</span><span class="n">__name__</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">meth</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">meth</span><span class="p">:</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">generic_visit</span>
        <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"generic_visit "</span> <span class="o">+</span> <span class="n">node</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"visit_B "</span> <span class="o">+</span> <span class="n">node</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">A</span><span class="p">(),</span> <span class="n">B</span><span class="p">(),</span> <span class="n">C</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">visitor</span> <span class="o">=</span> <span class="n">Visitor</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">visitor</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">generic_visit</span> <span class="n">A</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">visitor</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">visit_B</span> <span class="n">B</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">visitor</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">visit_B</span> <span class="n">C</span>
</code></pre></div></div>

<h2 id="другие-паттерны">Другие паттерны</h2>

<h3 id="три-способа-инъекции-зависимостей">Три способа инъекции зависимостей</h3>

<p>Внедрение зависимостей — это метод, при котором один объект предоставляет зависимости (сервисы) другому объекту (клиенту). Это позволяет отделять объекты: нет необходимости изменять клиентский код если возникла потребность изменить код сервиса.</p>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/dependency_injection.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="k">class</span> <span class="nc">ConstructorInjection</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_provider</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">time_provider</span> <span class="o">=</span> <span class="n">time_provider</span>

    <span class="k">def</span> <span class="nf">get_current_time_as_html_fragment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">time_provider</span><span class="p">()</span>
        <span class="n">current_time_as_html_fragment</span> <span class="o">=</span> <span class="s">'&lt;span class="tinyBoldText"&gt;{}&lt;/span&gt;'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
            <span class="n">current_time</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">current_time_as_html_fragment</span>


<span class="k">class</span> <span class="nc">ParameterInjection</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_current_time_as_html_fragment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_provider</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time_provider</span><span class="p">()</span>
        <span class="n">current_time_as_html_fragment</span> <span class="o">=</span> <span class="s">'&lt;span class="tinyBoldText"&gt;{}&lt;/span&gt;'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
            <span class="n">current_time</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">current_time_as_html_fragment</span>


<span class="k">class</span> <span class="nc">SetterInjection</span><span class="p">:</span>
    <span class="s">"""Setter Injection"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">set_time_provider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_provider</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">time_provider</span> <span class="o">=</span> <span class="n">time_provider</span>

    <span class="k">def</span> <span class="nf">get_current_time_as_html_fragment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">time_provider</span><span class="p">()</span>
        <span class="n">current_time_as_html_fragment</span> <span class="o">=</span> <span class="s">'&lt;span class="tinyBoldText"&gt;{}&lt;/span&gt;'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
            <span class="n">current_time</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">current_time_as_html_fragment</span>


<span class="k">def</span> <span class="nf">production_code_time_provider</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s">"""
    Production code version of the time provider (just a wrapper for formatting
    datetime for this example).
    """</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">current_time_formatted</span> <span class="o">=</span> <span class="s">f"</span><span class="si">{</span><span class="n">current_time</span><span class="p">.</span><span class="n">hour</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">current_time</span><span class="p">.</span><span class="n">minute</span><span class="si">}</span><span class="s">"</span>
    <span class="k">return</span> <span class="n">current_time_formatted</span>


<span class="k">def</span> <span class="nf">midnight_time_provider</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s">"""Hard-coded stub"""</span>
    <span class="k">return</span> <span class="s">"24:01"</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_ci1</span> <span class="o">=</span> <span class="n">ConstructorInjection</span><span class="p">(</span><span class="n">midnight_time_provider</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_ci1</span><span class="p">.</span><span class="n">get_current_time_as_html_fragment</span><span class="p">()</span>
<span class="s">'&lt;span class="tinyBoldText"&gt;24:01&lt;/span&gt;'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_ci2</span> <span class="o">=</span> <span class="n">ConstructorInjection</span><span class="p">(</span><span class="n">production_code_time_provider</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_ci2</span><span class="p">.</span><span class="n">get_current_time_as_html_fragment</span><span class="p">()</span>
<span class="s">'&lt;span class="tinyBoldText"&gt;...&lt;/span&gt;'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_pi</span> <span class="o">=</span> <span class="n">ParameterInjection</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_pi</span><span class="p">.</span><span class="n">get_current_time_as_html_fragment</span><span class="p">(</span><span class="n">midnight_time_provider</span><span class="p">)</span>
<span class="s">'&lt;span class="tinyBoldText"&gt;24:01&lt;/span&gt;'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_si</span> <span class="o">=</span> <span class="n">SetterInjection</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_si</span><span class="p">.</span><span class="n">get_current_time_as_html_fragment</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="p">...</span>
<span class="nb">AttributeError</span><span class="p">:</span> <span class="s">'SetterInjection'</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">'time_provider'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_si</span><span class="p">.</span><span class="n">set_time_provider</span><span class="p">(</span><span class="n">midnight_time_provider</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_with_si</span><span class="p">.</span><span class="n">get_current_time_as_html_fragment</span><span class="p">()</span>
<span class="s">'&lt;span class="tinyBoldText"&gt;24:01&lt;/span&gt;'</span>
</code></pre></div></div>

<h3 id="blackboard">Blackboard</h3>

<p>В шаблоне Blackboard несколько специализированных подсистем (источников данных) собирают свои знания для построения, возможно, частичного или приблизительного решения. Таким образом, подсистемы работают вместе для решения проблемы, где решение представляет собой сумму решений подсистем. <a href="https://github.com/faif/python-patterns/blob/master/patterns/other/blackboard.py">Пример</a></p>

<h3 id="graph-search">graph search</h3>

<p>Варианты поиска путей в графе на оснвое поиска в глубину, а так-же кратчайшие пути через поиск в глубину и в ширину. <a href="https://github.com/faif/python-patterns/blob/master/patterns/other/graph_search.py">Пример</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">class</span> <span class="nc">GraphSearch</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">find_path_dfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="n">path</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">newpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find_path_dfs</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">[:])</span>
                <span class="k">if</span> <span class="n">newpath</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">newpath</span>

    <span class="k">def</span> <span class="nf">find_all_paths_dfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">path</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">newpaths</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find_all_paths_dfs</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">[:])</span>
                <span class="n">paths</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">newpaths</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span> <span class="nf">find_shortest_path_dfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">path</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="n">shortest</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">newpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find_shortest_path_dfs</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">[:])</span>
                <span class="k">if</span> <span class="n">newpath</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">shortest</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">shortest</span><span class="p">):</span>
                        <span class="n">shortest</span> <span class="o">=</span> <span class="n">newpath</span>
        <span class="k">return</span> <span class="n">shortest</span>

    <span class="k">def</span> <span class="nf">find_shortest_path_bfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
        <span class="n">dist_to</span> <span class="o">=</span> <span class="p">{</span><span class="n">start</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">edge_to</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">queue</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">queue</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">graph</span><span class="p">[</span><span class="n">value</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dist_to</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">edge_to</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">dist_to</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_to</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">queue</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">edge_to</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">node</span> <span class="o">=</span> <span class="n">end</span>
                        <span class="k">while</span> <span class="n">dist_to</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">path</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
                            <span class="n">node</span> <span class="o">=</span> <span class="n">edge_to</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                        <span class="n">path</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
                        <span class="k">return</span>
</code></pre></div></div>

<h3 id="hiearchical-state-machine">Hiearchical state machine</h3>

<p><a href="https://github.com/faif/python-patterns/blob/master/patterns/other/hsm/hsm.py">Пример</a></p>

<p>[<a href="../lists/python-standart-library" title="Стандартная библиотека python и полезные ресурсы">python-standart-library</a>]</p>


  </div>
</article>


    </main>

    <footer role="banner">
<div class="border-top-thin clearfix mt-2 mt-lg-4">
    <div class="container mx-auto px-2">
      <p class="col-8 sm-width-full left py-2 mb-0"><a href="/myknowlegebase/">My knowledge base</a> проект поддерживается <a class="text-accent" href="https://github.com/KonstantinKlepikov">KonstantinKlepikov</a></p>
      <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
        <li class="inline-block mr-1">
          <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="My knowledge base">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </li>
      </ul>
    </div>
  </div>
</footer>

  </body>

</html>

<script type="text/javascript">
  // Hack: Replace page-link with "Page Title"
  document.querySelectorAll(".markdown-body a[title]").forEach((a) => {
    a.innerText = a.title;
  });
  // Hack: Remove .md extension from wikilinks to get the html in jekyll
  document.querySelectorAll("a").forEach(l => {
    if (l.href.endsWith('.md')) {
      l.href = l.href.substring(0, l.href.length-3)
    }
  })
</script>