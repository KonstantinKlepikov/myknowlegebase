---
description: Несколькор проблем в реализации темплейта fastapi
category: post
---
# Пррблемы с fastapi postgresql template

## YAMLLoadWarning

Specify the version of PyYaml < 5.1.

[link](https://github.com/tiangolo/docker-auto-labels/pull/4)

## services.pgadmin.depends_on must be a list

You have to delete all `depends_on` in your `docker-compose.yml.` As far as I know the are not mandatory for running :)

[link](https://github.com/tiangolo/full-stack-fastapi-postgresql/issues/273)

## networks.traefik-public Additional property name is not allowed

Simple fix was to move the version up to `3.6` in the `docker-compose.yml` and that then enabled it to spin up the stack.

[link](https://github.com/tiangolo/full-stack-fastapi-postgresql/issues/336)

## network "traefik-public" is declared as external, but could not be found. You need to create a swarm-scoped network before the stack is deployed

`network create -d overlay traefik-public`

[link](https://github.com/tiangolo/full-stack-fastapi-postgresql/issues/221)

## [[traefik]] version problems

Use `image: traefik:v2.2` in `dockero-compose.yml`

[link](https://github.com/tiangolo/full-stack-fastapi-postgresql/pull/199)

## [[traefik]] proxy deploy

Важно обратить внимание, что для [[fastapi-template-deployment]] используется два сервиса [[traefik]] - один публичный, второй внутренний. Если пренебречь этим, трафик в сеть и из сети не пойдет.

Вначале необходимо задеплоить сервис traefik так, как описано в [[docker-swarm-rocks]] в разделе про traefik. Затем нужно реализовать стек проекта так, как указано в документации темплейта [[fastapi-template-deployment]]

Прорблема обсуждается тут: [Clarification on deployment with Traefik, Docker-Compose, Swarm mode (from dockerswarm.rocks)](https://github.com/tiangolo/full-stack-fastapi-postgresql/issues/240) и тут: [Exposing ports for docker swarm](https://github.com/tiangolo/full-stack-fastapi-postgresql/issues/116)

> - traefik that is public facing (the one in [dockeswarm.rocks](https://dockeswarm.rocks)
> - proxy coming from this template which does not expose anything publicly (as it sits behind traefik)

Кроме того, для всех сабдоменов из стека [[fastapi-template-deployment]] необходимо создать A-записи, иначе сервисы не будут доступны.И еще нужно прописать CNAME для `www` - иначе не будут подписаны сертификаты lets enscript и https не будет сертифицирован. Как ээто сделать на [[digital-ocean]] читай тут: [[digital-ocean-dns-management]]

[[fastapi]]

[//begin]: # "Autogenerated link references for markdown compatibility"
[traefik]: ../notes/traefik "Traefik"
[traefik]: ../notes/traefik "Traefik"
[fastapi-template-deployment]: ../notes/fastapi-template-deployment "Fastapi template deployment"
[traefik]: ../notes/traefik "Traefik"
[docker-swarm-rocks]: ../notes/docker-swarm-rocks "Docker swarm rocks"
[fastapi-template-deployment]: ../notes/fastapi-template-deployment "Fastapi template deployment"
[fastapi-template-deployment]: ../notes/fastapi-template-deployment "Fastapi template deployment"
[digital-ocean]: ../lists/digital-ocean "Digital ocean"
[digital-ocean-dns-management]: ../notes/digital-ocean-dns-management "Digital ocean dns management"
[fastapi]: ../notes/fastapi "Fastapi"
[//end]: # "Autogenerated link references"